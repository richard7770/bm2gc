<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Loader</title>
  </head>
  <script>
    //

    function postCode(ev) {
      console.log('postCode', this, arguments);
      if( this.readyState == 4 && this.status == 200)
        window.opener.postMessage( this.responseText, '*')
    }
    var xhr = new XMLHttpRequest();
    xhr.open('get','load.js');
    xhr.onload = postCode;
    xhr.send();
  </script>
  <body>
    <p> Load javascript via messaging in order to serve js via http into https. </p>
    <p> Only for local use. </p>
    <code>
      javascript:
      (function() {
        var base = 'http://localhost:7780';
        window.addEventListener( 'message', function listener(ev){
          if(ev.source === nw){
            window.removeEventListener( 'message', listener);
            window.bm2gc_redirect = base + '/process.html';
            eval(ev.data);
            delete window.bm2gc_redirect;
            nw.close();
        }});
        var nw=window.open(base+'/loader.html','_blank');
      })()
    </code>
  </body>
</html>
